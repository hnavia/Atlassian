name: Build macOS Executable

on:
  workflow_dispatch:
    inputs:
      script:
        description: 'Script a compilar (ej: Standalone/MacroAnalyzer.py)'
        required: true
        default: 'Python Projects/Standalone/MacroAnalyzer.py/MacroAnalyzer.py'

jobs:
  build-macos:
    runs-on: macos-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.13

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pyinstaller

      - name: Extract script name
        id: extract
        run: |
          SCRIPT_PATH="${{ github.event.inputs.script }}"
          SCRIPT_NAME=$(basename "$SCRIPT_PATH" .py)
          echo "SCRIPT_PATH=$SCRIPT_PATH" >> $GITHUB_ENV
          echo "SCRIPT_NAME=$SCRIPT_NAME" >> $GITHUB_ENV
          echo "Compilando: $SCRIPT_PATH -> Nombre base: $SCRIPT_NAME"

      - name: Build macOS App
        run: |
          pyinstaller --windowed --name "$SCRIPT_NAME" "$SCRIPT_PATH"

      - name: Package app
        run: |
          cd dist
          zip -r "${SCRIPT_NAME}_for_MacOS.zip" "${SCRIPT_NAME}.app"

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: ${{ env.SCRIPT_NAME }}-macOS
          path: dist/${{ env.SCRIPT_NAME }}_for_MacOS.zip
